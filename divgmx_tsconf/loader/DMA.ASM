;--------------------------------------------------------------------------------; ƒл€ Win 2,3 автоматически идет запись в страницу     PG0(нолик)=0xF7, - служ инф ; дл€ Win 0,1 номер страницы находитс€ в €чейке пам€ти PGO(буковка"O")  - данные;PGO     EQU ZES+1;2;Temp Page;PGR     EQU PGO+2;2;Restore PagePREDMA  ; i:	; 	HL - dest adress	; o:    A  - PAGE	; 	DL - dest adress	LD C,PG0 ; C<-PG0  // PG0 EQU #F7	LD A,H   ; A<-DEST ADDR (A15, A14 = no meaning)        CP #80:JR NC,$+6: ;if A>0x80 then go to mask    :A15=1 (Win2,3)  	LD BC,(PGO)   	  ;if A<0x80 then BC<-(Temp Page)      (Win0,1)	;mask	        AND %00111111 ; mask A15, A14 = 0x0        LD D,A,A,C    ; D<-A [hi byte of dest addr] ; A<-C [page =0xF7]        LD BC,STS	INF:JP M,$-2  ; провер€ем готовность        RET	;--------------------------------------------------	;i:	; 	HL       - dest adress	;o:	; 	HL(+512) - dest adress	POSDMA  LD DE,512:ADD HL,DE  ;  HL+512,         LD A,H        CP #40:JR C, TSDL    ; when A < 0x40, RETURN : A14,A15 =0, same PAGE        CP #80:JR NC,TSDL    ; when A15 = 1,  RETURN : A15=1       (Win2,3)         AND %00111111:LD H,A ; ELSE: mask A15, A14 = 0x0        LD A,(PGO):INC A     ; (PG0)++ //счетчик страниц дл€ DMA ?        LD (PGO),A	TSDL    INF:JP M,$-2        RET;--------------------------------------------------------------------------------STS     EQU #27AF ;DMACtrl      —“ј“”—;------------------------------ адрес источника DMASL   EQU #1AAF ; - DMASAddrL внутри страницыDMASH   EQU #1BAF ; - DMASAddrH внутри страницыDMASX   EQU #1CAF ; - адрес  страницы источника;------------------------------ адрес приемника  DMADL   EQU #1DAF ;внутри страницы LoDMADH   EQU #1EAF ;внутри страницы HiDMADX   EQU #1FAF ;адресс страницы приемника;------------------------------------------------DMA_T   EQU #28AF ;0=1, 255=256 количество бурстовDMA_N   EQU #26AF ;255=512 // длина буста в диапазоне 2..512 байт с шагом 2 байта. DMA_C   EQU #27AF ;RW 1 - - - 0 0 1;---------------------------------------------------------------------------------